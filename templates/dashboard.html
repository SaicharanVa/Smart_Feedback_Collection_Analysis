{% extends "base.html" %}

{% block title %}My Dashboard - FeedbackHub{% endblock %}

{% block content %}
<div class="container">
    <div class="dashboard-container">
        <h1>My Feedback History</h1>
        <p class="subtitle">Welcome back, {{ current_user.name }}!</p>

        {% if feedbacks %}
            <div class="feedback-grid">
                {% for feedback in feedbacks %}
                    <div class="feedback-card">
                        <div class="feedback-header">
                            <span class="feedback-type">{{ feedback.feedback_type }}</span>
                            <span class="sentiment-badge sentiment-{{ feedback.sentiment.lower() }}">
                                {{ feedback.sentiment }}
                            </span>
                        </div>
                        <div class="feedback-content">
                            <p>{{ feedback.text }}</p>
                        </div>
                        {% if feedback.image_path %}
                            <div class="feedback-image">
                                <img src="{{ url_for('uploaded_file', filename=feedback.image_path) }}" 
                                     alt="Feedback image"
                                     class="thumbnail"
                                     onclick="openImageModal('{{ url_for('uploaded_file', filename=feedback.image_path) }}')">
                            </div>
                        {% endif %}
                        <div class="feedback-footer">
                            {% if feedback.rating %}
                                <div class="rating-display">
                                    Rating: 
                                    {% for i in range(feedback.rating) %}
                                        <span class="star-filled">★</span>
                                    {% endfor %}
                                    {% for i in range(5 - feedback.rating) %}
                                        <span class="star-empty">☆</span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <span class="feedback-date">{{ feedback.timestamp.strftime('%B %d, %Y') }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <p>You haven't submitted any feedback yet.</p>
                <a href="{{ url_for('index') }}" class="btn btn-primary">Submit Your First Feedback</a>
            </div>
        {% endif %}
    </div>
</div>

<div id="imageModal" class="modal">
    <span class="modal-close" onclick="closeImageModal()">&times;</span>
    <img class="modal-content" id="modalImage">
</div>

<script>
function openImageModal(imageSrc) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.style.display = 'block';
    modalImg.src = imageSrc;
}

function closeImageModal() {
    document.getElementById('imageModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('imageModal');
    if (event.target == modal) {
        closeImageModal();
    }
}
</script>
{% endblock %}
